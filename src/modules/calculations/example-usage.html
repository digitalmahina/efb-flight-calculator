<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üßÆ –ú–æ–¥—É–ª—å CALCULATIONS - –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        
        input, select, button {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .result {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
        }
        
        .error {
            background: #fdf2f2;
            border: 2px solid #e74c3c;
            color: #c0392b;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .waypoint {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .waypoint h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .coordinates {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ –ú–æ–¥—É–ª—å CALCULATIONS</h1>
        <p style="text-align: center; font-size: 1.2em; color: #7f8c8d;">
            –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –º–æ–¥—É–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–ª–µ—Ç–∞
        </p>
        
        <div id="status" class="status loading">
            –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è...
        </div>
        
        <div class="grid">
            <!-- –ë–∞–∑–æ–≤—ã–µ —Ä–∞—Å—á–µ—Ç—ã -->
            <div class="section">
                <h2>üìè –ë–∞–∑–æ–≤—ã–µ —Ä–∞—Å—á–µ—Ç—ã</h2>
                
                <div class="input-group">
                    <label>–¢–æ—á–∫–∞ A (—à–∏—Ä–æ—Ç–∞, –¥–æ–ª–≥–æ—Ç–∞):</label>
                    <div class="coordinates">
                        <input type="number" id="lat1" placeholder="55.7558" step="0.0001">
                        <input type="number" id="lon1" placeholder="37.6176" step="0.0001">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>–¢–æ—á–∫–∞ B (—à–∏—Ä–æ—Ç–∞, –¥–æ–ª–≥–æ—Ç–∞):</label>
                    <div class="coordinates">
                        <input type="number" id="lat2" placeholder="59.9311" step="0.0001">
                        <input type="number" id="lon2" placeholder="30.3609" step="0.0001">
                    </div>
                </div>
                
                <button onclick="calculateDistance()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ</button>
                <div id="distanceResult" class="result" style="display: none;"></div>
            </div>
            
            <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª–µ—Ç–∞ -->
            <div class="section">
                <h2>‚úàÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª–µ—Ç–∞</h2>
                
                <div class="input-group">
                    <label>–ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á):</label>
                    <input type="number" id="cruiseSpeed" value="200" min="1" max="1000">
                </div>
                
                <div class="input-group">
                    <label>–†–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞ (–∫–≥/—á):</label>
                    <input type="number" id="fuelFlow" value="600" min="1" max="5000">
                </div>
                
                <div class="input-group">
                    <label>–†–µ–∑–µ—Ä–≤ —Ç–æ–ø–ª–∏–≤–∞ (%):</label>
                    <input type="number" id="reserveFuel" value="10" min="0" max="100">
                </div>
                
                <button onclick="calculateFlightParams()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
                <div id="paramsResult" class="result" style="display: none;"></div>
            </div>
        </div>
        
        <!-- –ú–∞—Ä—à—Ä—É—Ç -->
        <div class="section">
            <h2>üõ£Ô∏è –†–∞—Å—á–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∞</h2>
            
            <div id="waypoints">
                <div class="waypoint">
                    <h4>–¢–æ—á–∫–∞ 1</h4>
                    <div class="coordinates">
                        <input type="number" placeholder="–®–∏—Ä–æ—Ç–∞" step="0.0001">
                        <input type="number" placeholder="–î–æ–ª–≥–æ—Ç–∞" step="0.0001">
                    </div>
                    <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏" style="margin-top: 10px;">
                </div>
            </div>
            
            <button onclick="addWaypoint()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</button>
            <button onclick="calculateRoute()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
            
            <div id="routeResult" class="result" style="display: none;"></div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="section">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤</h2>
            <div id="results" class="result">
                –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤...
            </div>
        </div>
    </div>

    <script type="module">
        import Calculations from './calculations.js';
        
        let calculationsModule = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
        async function initModule() {
            try {
                calculationsModule = Calculations;
                await calculationsModule.init();
                
                document.getElementById('status').className = 'status success';
                document.getElementById('status').textContent = '‚úÖ –ú–æ–¥—É–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ';
                
                // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞–º–∏
                document.getElementById('lat1').value = 55.7558;
                document.getElementById('lon1').value = 37.6176;
                document.getElementById('lat2').value = 59.9311;
                document.getElementById('lon2').value = 30.3609;
                
            } catch (error) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message;
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }
        
        // –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
        window.calculateDistance = function() {
            try {
                const lat1 = parseFloat(document.getElementById('lat1').value);
                const lon1 = parseFloat(document.getElementById('lon1').value);
                const lat2 = parseFloat(document.getElementById('lat2').value);
                const lon2 = parseFloat(document.getElementById('lon2').value);
                
                if (isNaN(lat1) || isNaN(lon1) || isNaN(lat2) || isNaN(lon2)) {
                    throw new Error('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã');
                }
                
                const distance = calculationsModule.calculateDistance(lat1, lon1, lat2, lon2);
                const result = `–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance.toFixed(2)} –∫–º`;
                
                document.getElementById('distanceResult').textContent = result;
                document.getElementById('distanceResult').style.display = 'block';
                document.getElementById('distanceResult').className = 'result';
                
            } catch (error) {
                document.getElementById('distanceResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('distanceResult').style.display = 'block';
                document.getElementById('distanceResult').className = 'result error';
            }
        };
        
        // –†–∞—Å—á–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–ª–µ—Ç–∞
        window.calculateFlightParams = function() {
            try {
                const distance = 635; // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ú–æ—Å–∫–≤–∞-–°–ü–±
                const speed = parseFloat(document.getElementById('cruiseSpeed').value);
                const fuelFlow = parseFloat(document.getElementById('fuelFlow').value);
                const reservePercent = parseFloat(document.getElementById('reserveFuel').value);
                
                const time = calculationsModule.calculateTime(distance, speed);
                const baseFuel = calculationsModule.calculateFuel(time, fuelFlow);
                const fuelWithReserve = calculationsModule.fuel.calculateFuelWithReserve(baseFuel, reservePercent);
                
                const result = `
–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance} –∫–º
–í—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞: ${calculationsModule.formatTime(time)}
–ë–∞–∑–æ–≤–æ–µ —Ç–æ–ø–ª–∏–≤–æ: ${baseFuel.toFixed(1)} –∫–≥
–†–µ–∑–µ—Ä–≤: ${fuelWithReserve.reserveFuel.toFixed(1)} –∫–≥
–û–±—â–µ–µ —Ç–æ–ø–ª–∏–≤–æ: ${fuelWithReserve.totalFuel.toFixed(1)} –∫–≥
                `.trim();
                
                document.getElementById('paramsResult').textContent = result;
                document.getElementById('paramsResult').style.display = 'block';
                document.getElementById('paramsResult').className = 'result';
                
            } catch (error) {
                document.getElementById('paramsResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('paramsResult').style.display = 'block';
                document.getElementById('paramsResult').className = 'result error';
            }
        };
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞
        window.addWaypoint = function() {
            const waypointsContainer = document.getElementById('waypoints');
            const waypointCount = waypointsContainer.children.length + 1;
            
            const waypointDiv = document.createElement('div');
            waypointDiv.className = 'waypoint';
            waypointDiv.innerHTML = `
                <h4>–¢–æ—á–∫–∞ ${waypointCount}</h4>
                <div class="coordinates">
                    <input type="number" placeholder="–®–∏—Ä–æ—Ç–∞" step="0.0001">
                    <input type="number" placeholder="–î–æ–ª–≥–æ—Ç–∞" step="0.0001">
                </div>
                <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏" style="margin-top: 10px;">
            `;
            
            waypointsContainer.appendChild(waypointDiv);
        };
        
        // –†–∞—Å—á–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∞
        window.calculateRoute = function() {
            try {
                const waypoints = [];
                const waypointElements = document.querySelectorAll('.waypoint');
                
                waypointElements.forEach((element, index) => {
                    const inputs = element.querySelectorAll('input');
                    const lat = parseFloat(inputs[0].value);
                    const lon = parseFloat(inputs[1].value);
                    const name = inputs[2].value || `WPT${index + 1}`;
                    
                    if (!isNaN(lat) && !isNaN(lon)) {
                        waypoints.push({ lat, lon, name });
                    }
                });
                
                if (waypoints.length < 2) {
                    throw new Error('–î–æ–±–∞–≤—å—Ç–µ –º–∏–Ω–∏–º—É–º 2 —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞');
                }
                
                const params = {
                    cruiseSpeed: parseFloat(document.getElementById('cruiseSpeed').value),
                    fuelFlow: parseFloat(document.getElementById('fuelFlow').value),
                    reserveFuel: parseFloat(document.getElementById('reserveFuel').value)
                };
                
                const result = calculationsModule.calculateRoute(waypoints, params);
                
                let resultText = `
–ú–ê–†–®–†–£–¢ –†–ê–°–ß–ï–¢–ê–ù –£–°–ü–ï–®–ù–û

–û–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
‚Ä¢ –û–±—â–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${result.formattedDistance}
‚Ä¢ –û–±—â–µ–µ –≤—Ä–µ–º—è: ${result.formattedTime}
‚Ä¢ –û–±—â–∏–π —Ä–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞: ${result.formattedFuel}

–î–µ—Ç–∞–ª–∏ –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º:
`;
                
                result.segments.forEach((segment, index) => {
                    resultText += `
${index + 1}. ${segment.from} ‚Üí ${segment.to}
   –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${segment.distance} –∫–º
   –í—Ä–µ–º—è: ${segment.formattedTime}
   –¢–æ–ø–ª–∏–≤–æ: ${segment.fuel} –∫–≥
   –ö—É—Ä—Å: ${segment.bearing}¬∞
`;
                });
                
                resultText += `
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚Ä¢ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–∞: ${result.statistics.routeEfficiency}%
‚Ä¢ –¢–æ–ø–ª–∏–≤–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${result.statistics.fuelEfficiency} –∫–≥/–∫–º
‚Ä¢ –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: ${result.statistics.averageSpeed} –∫–º/—á

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: ${result.safety.isSafe ? '‚úÖ –ú–∞—Ä—à—Ä—É—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω' : '‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è'}
                `;
                
                document.getElementById('routeResult').textContent = resultText;
                document.getElementById('routeResult').style.display = 'block';
                document.getElementById('routeResult').className = 'result';
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                document.getElementById('results').textContent = resultText;
                
            } catch (error) {
                document.getElementById('routeResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('routeResult').style.display = 'block';
                document.getElementById('routeResult').className = 'result error';
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        initModule();
    </script>
</body>
</html>
